INFO FOR CODEX
Ultimo aggiornamento: 2026-02-06

Scopo del progetto
Family Meal Planner è una web app per la gestione dei pasti in famiglia. Consente di pianificare pranzi e cene su calendario, gestire un catalogo piatti con ingredienti, generare la lista della spesa e suggerire pasti per evitare ripetizioni e mantenere un’alimentazione bilanciata. Supporta l’uso multi‑famiglia con inviti e dati isolati per nucleo.

Com’è costruita
- Frontend: Next.js 14 (App Router) con TypeScript, React Bootstrap e FullCalendar.
- Backend: Node.js + Express con TypeScript.
- Database: PostgreSQL con Prisma ORM.
- Autenticazione: OAuth 2.0 (Google, GitHub) con sessioni server-side.

Cosa fa (stato attuale)
- Autenticazione OAuth e gestione sessione.
- Gestione famiglia: info, aggiornamento, inviti e lista inviti.
- Gestione piatti: CRUD con categorie e ingredienti.
- Pianificazione pasti: CRUD per pranzi/cene su base settimanale.
- Suggerimenti pasti: evita ripetizioni recenti, limita uso e bilancia la settimana.
- Lista spesa: generazione da ingredienti dei pasti pianificati e spunta acquisti.
- Interfaccia: dashboard, calendario, piatti, spesa, impostazioni, login e inviti.

Cosa dovrebbe fare (prossimi passi noti)
- Rifinire la UX del calendario e la modifica rapida dei pasti.
- Migliorare il sistema di suggerimenti con preferenze e vincoli nutrizionali.
- Agganciare flussi completi di invito e onboarding per nuovi membri.

Note operative
- Backend: `backend/` con Prisma e migrazioni.
- Frontend: `frontend/` con pagine App Router.
- Avvio: vedere `install.txt`.
 - Flusso multi‑tab: un branch per tab; sincronizzare su `develop`.
- PostgreSQL: usa PG16 su porta 5432 (PG18 rimosso).

Stato branch
- Branch attuale: feature/gestione-calendario.
- Branch principali: main (production), develop (sviluppo).

Prossimo obiettivo
- Iterare su UX calendario e modifica rapida dei pasti.

Changelog
- 2026-02-02: Creato infoForCodex.txt con descrizione iniziale del progetto.
- 2026-02-02: Aggiunte note sul flusso multi‑tab e branching parallelo.
- 2026-02-04: Redesign UI basato su v4 (gradienti, bubble cards, day pills) su dashboard, calendario, spesa e impostazioni.
- 2026-02-04: Fix calendario (range visibile, date click senza shift, parsing date‑only UTC) e alert duplicati.
- 2026-02-04: Dashboard aggiornata a settimana lun‑dom con navigazione e modal add‑meal inline.
- 2026-02-04: Day strip dashboard: badge "Oggi" e highlight giallo per oggi/selected.
- 2026-02-04: Calendario non si resetta al mese corrente durante la navigazione (loading overlay senza unmount).
- 2026-02-04: Calendario ottimizzato con caching (placeholder data) per ridurre flicker durante la navigazione.
- 2026-02-04: Aggiunto micro‑spinner di stato nel titolo Calendario durante fetch.
- 2026-02-04: Import CSV piatti in /piatti e pulsante “Cancella Tutti” con eliminazione pianificazioni collegate.
- 2026-02-04: Aggiunta nota UI sul formato CSV nella pagina Piatti.
- 2026-02-04: Aggiunto export CSV dei piatti in /piatti.
- 2026-02-04: Dashboard hero titolo in singola riga.
- 2026-02-04: Dashboard apre settimana corrente con oggi selezionato di default.
- 2026-02-04: Aggiunta città famiglia (default Roma) e meteo in dashboard con endpoint /api/weather.
- 2026-02-04: Fix ReferenceError in dashboard (weather query dentro componente).
- 2026-02-04: Impostazioni: aggiunto riepilogo con nome famiglia, città e numero membri.
- 2026-02-04: Impostazioni: riepilogo mostra solo i nomi dei membri (senza totale).
- 2026-02-04: Dashboard: aggiunto tasto rimozione pranzo/cena per poter riscegliere.
- 2026-02-04: Sostituiti gli Alert con modali di stato (StatusModal).
- 2026-02-04: Calendario: rimozione rapida evento con bottone sulla card evento.
- 2026-02-04: Sostituiti i confirm() con ConfirmModal (dashboard, calendario, piatti, spesa, impostazioni).
- 2026-02-04: Fix 500 su /auth/me: isAuthenticated gestisce req.isAuthenticated mancante.
- 2026-02-04: Script reset_db_passwords.sh aggiornato (psql via utente postgres, cd /tmp).
- 2026-02-04: Script reset_db_passwords.sh aggiorna stop/start automatico se già in esecuzione.
- 2026-02-04: Password postgres reset su PG16/PG18; creato db_credentials.txt con liste DB.
- 2026-02-04: Script dev_start/dev_stop aggiornati per usare PostgreSQL 16.
- 2026-02-04: Documentazione prerequisiti aggiornata (PG16 consigliato).
- 2026-02-04: .env.example aggiornato con nota su PostgreSQL 16.
- 2026-02-04: Aggiunti script dev_start/dev_stop e documentazione in install.txt/README.
- 2026-02-06: Rimosso PostgreSQL 18 dal Mac di sviluppo; standardizzato su PostgreSQL 16 (porta 5432).
- 2026-02-06: /auth/me ora ritorna 200 con user null quando non autenticato (evita 401 in console).
- 2026-02-06: dev_stop.sh ora termina anche i processi node rimasti sulle porte 3000-3003.
- 2026-02-06: Pagina /piatti: pulsanti CSV con stile soft; “Cancella Tutti” versione soft rossa.
- 2026-02-06: Navbar: dropdown utente su una riga con ellipsis per nomi lunghi.
- 2026-02-06: /piatti: import/export CSV in modale; export con pulsante download e stile modal aggiornato.
- 2026-02-06: Aggiunta pagina Statistiche (week/month) con piatti più frequenti e non mangiati.
- 2026-02-06: Route Statistiche spostata da /menu a /statistiche.
- 2026-02-06: Migrazione MealPlan con slot categoria (primo/secondo/contorno) e vincolo unico per slot.
- 2026-02-06: Dashboard/Calendario aggiornati con 3 select per pranzo e cena (slot categoria).
- 2026-02-06: /piatti aggiunta auto-programmazione pasti con range selezionabili.
- 2026-02-06: Suggerimenti aggiornati per categoria slot.
- 2026-02-06: sample_dishes.csv corretto (pangrattato).
- 2026-02-06: Allineate label slot (primo/secondo/contorno) in dashboard e calendario.
- 2026-02-06: Dashboard: azioni rapide spostate in alto, modali per aggiungere piatto e item spesa.
- 2026-02-06: Spesa: lista manuale (niente generazione automatica), aggiunta item via UI/API.
- 2026-02-06: Dashboard: azioni rapide in box dinamico, allineato ai suggeriti; day strip e azioni rapide nello stesso layout.
- 2026-02-06: Dashboard: layout top rifatto (week strip sopra, day strip + azioni rapide in grid) e fix mobile per pulsanti.
- 2026-02-06: Auto-programmazione: scelta slot per pranzo/cena + preset combinazioni.
- 2026-02-06: Stile Annulla uniformato a Cancella Tutti (btn-secondary rosso soft).
- 2026-02-06: Calendario: svuota intervallo con range selezionabili (oltre a svuota tutto).
- 2026-02-06: Auto-programmazione mese: fix timezone/DATE con dateKey + parseDateOnly.
- 2026-02-06: Calendario: ordine eventi pranzo→slot e evidenza oggi con background accent-lunch.
- 2026-02-06: Badge categorie (primo/secondo/contorno) con colori distinti forzati.
- 2026-02-06: Aggiunti asset prototipo (dashboard.png, screen_dashboard.png, v4-bubble-world.jsx, meal-planner-prototype.jsx, modal_example.webp) e rimosso vecchio /menu.
- 2026-02-06: .gitignore aggiornato per logs/ e .dev_pids/.
